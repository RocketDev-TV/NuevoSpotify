<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - NuevoSpotify</title>

    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/admin/dashboard.css">
    <link rel="stylesheet" href="../css/admin/analytics.css">
    <link rel="stylesheet" href="../css/admin/music-manager.css">

    <link rel="icon" type="image/png" href="../img/panelAdmin-icono.png">

    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="admin-body">

    <div class="admin-container">
        <aside class="sidebar">
            <div class="logo-area">
                <h2>AdminPanel</h2>
            </div>
            <nav class="menu">
                <button class="menu-btn active" onclick="cambiarVista('analytics')">
                    <i class="ph ph-chart-line-up"></i> Anal√≠ticas
                </button>
                <button class="menu-btn" onclick="cambiarVista('music')">
                    <i class="ph ph-music-notes-plus"></i> Music manager
                </button>
                <button class="menu-btn" onclick="cambiarVista('users')">
                    <i class="ph ph-users"></i> Usuarios
                </button>
            </nav>
            <div class="logout-area">
                <button id="btnLogout" class="menu-btn logout">
                    <i class="ph ph-sign-out"></i> Salir
                </button>
            </div>
        </aside>

        <main class="main-content">

            <header class="top-bar">
                <div class="welcome-text">
                    <h1>Hola, <span id="adminName">Admin</span> üëã</h1>
                    <p id="fullDateDisplay">Cargando fecha...</p>
                </div>
                <div class="clock-card">
                    <i class="ph ph-clock"></i>
                    <span id="clockTime">00:00</span>
                </div>
            </header>

            <section id="view-analytics" class="view-section active">
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="icon-box"><i class="ph ph-users-three"></i></div>
                        <div class="kpi-info">
                            <div class="kpi-header">
                                <h3>Usuarios Totales</h3>
                                <span class="badge green"><i class="ph ph-arrow-up-right"></i> Global</span>
                            </div>
                            <p class="kpi-number" id="totalUsers">0</p>
                        </div>
                    </div>

                    <div class="kpi-card">
                        <div class="icon-box new"><i class="ph ph-user-plus"></i></div>
                        <div class="kpi-info">
                            <div class="kpi-header">
                                <h3>Nuevos (Hoy)</h3>
                                <span class="badge green"><i class="ph ph-lightning"></i> Actividad</span>
                            </div>
                            <p class="kpi-number" id="newUsers">0</p>
                        </div>
                    </div>

                    <div class="kpi-card">
                        <div class="icon-box active"><i class="ph ph-activity"></i></div>
                        <div class="kpi-info">
                            <div class="kpi-header">
                                <h3>Activos Ahora</h3>
                                <span class="badge purple"><i class="ph ph-pulse"></i> Retenci√≥n</span>
                            </div>
                            <p class="kpi-number" id="activeUsers">0</p>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Crecimiento de Usuarios</h3>
                    <div class="chart-wrapper">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="view-music" class="view-section" style="display: none;">
                <div class="manager-header">
                    <h2>Gestor de M√∫sica</h2>
                    <div class="tabs">
                        <button class="tab-btn active" onclick="cambiarTabMusic('importar')">Importar (Spotify)</button>
                        <button class="tab-btn" onclick="cambiarTabMusic('manual')">Subida Manual</button>
                    </div>
                </div>

                <div id="tab-importar" class="music-tab active">
                    <div class="glass-panel">
                        <h3><i class="ph ph-spotify-logo"></i> Clonador de Playlists</h3>
                        <p>Pega el link de una playlist o canci√≥n de Spotify y deja que la magia suceda.</p>
                        <div class="input-group-row">
                            <input type="text" placeholder="https://open.spotify.com/playlist/..." id="spotifyLink">
                            <button class="btn-primary" id="btnClonar">
                                <i class="ph ph-download-simple"></i> Clonar
                            </button>
                        </div>
                        <div id="cloner-status" class="status-area">
                        </div>
                    </div>
                </div>

                <div id="tab-manual" class="music-tab" style="display: none;">
    
                    <div class="grid-2-cols">
                        
                        <div class="glass-panel">
                            <h3>1. Definir contexto</h3>
                            <p class="instruction-text">Selecciona o crea el artista y √°lbum donde se guardar√°n las canciones.</p>
                
                            <form id="formMetadata">
                                <label>G√©nero Musical</label>
                                <div class="input-group-row compact">
                                    <select id="selectGenero">
                                        <option value="">Cargando g√©neros...</option>
                                    </select>
                                    <button type="button" class="btn-icon" onclick="abrirModal('genero')">
                                        <i class="ph ph-plus"></i>
                                    </button>
                                </div>
                
                                <label>Artista</label>
                                <div class="input-group-row compact">
                                    <select id="selectArtista" disabled>
                                        <option value="">Selecciona un g√©nero primero</option>
                                    </select>
                                    <button type="button" class="btn-icon" onclick="abrirModal('artista')">
                                        <i class="ph ph-plus"></i>
                                    </button>
                                </div>
                
                                <label>√Ålbum / EP</label>
                                <div class="input-group-row compact">
                                    <select id="selectAlbum" disabled>
                                        <option value="">Selecciona un artista primero</option>
                                    </select>
                                    <button type="button" class="btn-icon" onclick="abrirModal('album')">
                                        <i class="ph ph-plus"></i>
                                    </button>
                                </div>
                
                                <div id="coverArea" style="display:none; margin-top:15px; text-align: center;">
                                    <img id="currentCover" src="" class="cover-preview-large" style="max-width: 150px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
                                </div>
                
                                <button type="button" class="btn-secondary mt-3" id="btnLockContext" onclick="bloquearContexto()">
                                    <i class="ph ph-lock-key"></i> Confirmar para subir
                                </button>
                            </form>
                
                            <div id="albumInventoryContainer" style="display: none; margin-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 1.5rem;">
                                
                                <div class="d-flex justify-content-between align-items-end mb-3">
                                    <div>
                                        <h6 class="text-success text-uppercase mb-1" style="font-size: 0.75rem; letter-spacing: 1px;">En este √°lbum:</h6>
                                        <div class="d-flex align-items-baseline gap-2">
                                            <h4 id="inventoryTitle" class="text-white mb-0" style="font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px;">T√≠tulo</h4>
                                            <span id="inventoryYear" class="text-secondary" style="font-size: 0.9rem;">(----)</span>
                                        </div>
                                    </div>
                                    <span id="albumTotalSongs" class="badge bg-dark text-secondary border border-secondary rounded-pill">0 tracks</span>
                                </div>
                
                                <div style="margin-top: 2rem; margin-left: -1.5rem; margin-right: -1.5rem; margin-bottom: -1.5rem; overflow-x: hidden;">
                                    
                                    <table class="table table-dark table-sm table-hover mb-0 align-middle" style="width: 100%; table-layout: fixed; background: transparent;">
                                        <thead>
                                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); color: #888; font-size: 0.85rem;">
                                                <th class="text-center ps-4" style="width: 50px;">#</th>
                                                <th>T√≠tulo</th>
                                                <th class="text-center" style="width: 80px;"><i class="ph ph-clock"></i></th>
                                                <th class="text-end pe-4" style="width: 60px;"></th> 
                                            </tr>
                                        </thead>
                                        <tbody id="albumSongsTableBody" style="font-size: 0.95rem;">
                                            </tbody>
                                    </table>
                
                                </div>
                            </div>
                            <style>
                                #albumSongsTableBody td:nth-child(2) {
                                    white-space: nowrap;
                                    overflow: hidden;
                                    text-overflow: ellipsis;
                                }
                            </style>
                            </div>
                
                        <div class="glass-panel">
                            <h3>2. Carga masiva (EPs / √Ålbums)</h3>
                            <form id="formCancion">
                                <p class="instruction-text">Aseg√∫rate de haber guardado el Artista/√Ålbum a la izquierda primero.</p>
                
                                <div class="file-upload-wrapper">
                                    <input type="file" id="inputFileAudio" accept="audio/*" multiple hidden>
                
                                    <label for="inputFileAudio" class="custom-file-upload">
                                        <div id="dropZone" class="upload-area">
                                            <i class="ph ph-cloud-arrow-up"></i>
                                            <p id="fileLabelText">Click para elegir canciones o arrastra aqu√≠</p>
                                        </div>
                                        <span class="file-count" id="fileCountBadge" style="display:none;">
                                            0 archivos
                                        </span>
                                    </label>
                                </div>
                
                                <div id="fileListPreview" class="file-list-area"></div>
                
                                <button type="submit" class="btn-primary full-width">
                                    <i class="ph ph-upload-simple"></i> Procesar todo el √°lbum
                                </button>
                            </form>
                        </div>
                    </div> 
                </div>
            </section>
        </main>
    </div>

    <div id="modal-genero" class="modal-overlay">
        <div class="modal-content">
            <h3>Nuevo G√©nero</h3>
            <input type="text" id="newGenreName" placeholder="Ej. Indie Rock">
            <label style="color: #bbb; font-size: 12px; margin-bottom: 5px; display:block;">D√©cada Principal</label>
            <select id="newGenreDecade">
                <option value="2020-01-01">2020s (Actualidad)</option>
                <option value="2010-01-01">2010s</option>
                <option value="2000-01-01">2000s</option>
                <option value="1990-01-01">90s</option>
                <option value="1980-01-01">80s</option>
                <option value="1970-01-01">70s</option>
                <option value="1960-01-01">60s</option>
            </select>
            <div class="modal-actions">
                <button onclick="cerrarModal('genero')" class="btn-cancel">Cancelar</button>
                <button onclick="crearGenero()" class="btn-confirm">Guardar</button>
            </div>
        </div>
    </div>

    <div id="modal-artista" class="modal-overlay">
        <div class="modal-content">
            <h3>Nuevo Artista</h3>
            <input type="text" id="newArtistName" placeholder="Ej. Zo√©">
            <textarea id="newArtistDesc" placeholder="Descripci√≥n breve..."></textarea>
            <div class="modal-actions">
                <button onclick="cerrarModal('artista')" class="btn-cancel">Cancelar</button>
                <button onclick="crearArtista()" class="btn-confirm">Guardar</button>
            </div>
        </div>
    </div>

    <div id="modal-album" class="modal-overlay">
        <div class="modal-content">
            <h3>Nuevo √Ålbum/EP</h3>
            <input type="text" id="newAlbumTitle" placeholder="Ej. Reptilectric">
            <label>Portada</label>
            <input type="file" id="newAlbumCover" accept="image/*">
            <div class="form-group">
                <label>Tipo de Lanzamiento</label>
                <select id="newAlbumType" class="form-control">
                    <option value="ALBUM">√Ålbum (LP)</option>
                    <option value="EP">EP (Extended Play)</option>
                    <option value="SINGLE">Sencillo</option>
                </select>
            </div>
            <div class="row-dates">
                <input type="date" id="newAlbumDate">
                <input type="number" id="newAlbumSongs" placeholder="Num. Canciones">
            </div>
            <div class="modal-actions">
                <button onclick="cerrarModal('album')" class="btn-cancel">Cancelar</button>
                <button onclick="crearAlbum()" class="btn-confirm">Guardar</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="module" src="../Js/admin-dashboard.js"></script>
    <script type="module" src="../Js/admin/analytics.js"></script>
    <script type="module" src="../Js/admin/modules/music/main.js"></script>
</body>

</html>